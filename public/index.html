<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#0d0b09">
    
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>openmud – Open-source AI for Heavy Civil Construction</title>
    <meta name="description" content="The open-source AI platform for heavy civil and underground utility construction. Free estimating, calculators, scheduling, proposals, and field resources. Built by contractors, for contractors.">
    <meta property="og:title" content="openmud">
    <meta property="og:description" content="Open-source AI for heavy civil construction. Free estimating, calculators, scheduling, proposals, and OSHA reference — built by contractors.">
    <meta property="og:url" content="https://openmud.ai">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://openmud.ai/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://openmud.ai/og-image.png">
    <meta name="twitter:title" content="openmud">
    <meta name="twitter:description" content="Open-source AI for heavy civil construction.">
    <link rel="stylesheet" href="css/landing.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Vercel Analytics -->
    <script defer src="/_vercel/insights/script.js"></script>
    <!-- Vercel Speed Insights -->
    <script defer src="/_vercel/speed-insights/script.js"></script>
</head>
<body>

    <!-- Nav -->
    <nav class="lp-nav">
        <a href="/" class="lp-nav-logo">openmud</a>
        <div class="lp-nav-links">
            <a href="/about.html">About</a>
            <a href="/chat.html">AI Chat</a>
            <a href="/calculators.html">Calculators</a>
            <a href="/resources.html">Resources</a>
            <a href="/innovators.html">Innovators</a>
            <a href="/companies.html">Companies</a>
            <a href="/documentation.html">Documentation</a>
            <a href="https://discord.gg/qszzMjxD3" target="_blank" rel="noopener">Discord</a>
            <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener">GitHub</a>
            <a href="/chat.html" class="lp-nav-cta">Try it free →</a>
        </div>
    </nav>

    <!-- Hero background video — served from Pexels CDN, no repo storage -->
    <section class="lp-hero-video-wrap">
        <div class="lp-video-bg" aria-hidden="true">
            <video id="bg-video" autoplay muted playsinline loop preload="auto">
                <source src="https://videos.pexels.com/video-files/6618333/6618333-hd_1920_1080_24fps.mp4" type="video/mp4">
                <source src="https://videos.pexels.com/video-files/6618021/6618021-hd_1920_1080_24fps.mp4" type="video/mp4">
            </video>
        </div>
        <div class="lp-video-overlay" aria-hidden="true"></div>

        <!-- Hero content -->
        <div class="lp-hero lp-hero-over-video">
            <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener" class="lp-hero-eyebrow">
                <span class="lp-hero-eyebrow-dot"></span>
                Open source · MIT license · v0.1.0 on GitHub
            </a>
            <h1 class="lp-hero-title">
                AI for<br><em>construction.</em>
            </h1>
            <p class="lp-hero-sub">
                Free tools for estimating, scheduling, and proposals — built by contractors, for contractors. Use the AI, fork the code, contribute what you know.
            </p>

            <!-- Search bar -->
            <div class="lp-search-container">
                <div class="lp-search-wrap">
                    <form class="lp-search-form" id="site-search-form" onsubmit="runSearch(event)">
                    <input
                        type="text"
                        id="site-search-input"
                        class="lp-search-input"
                        placeholder=""
                        autocomplete="off"
                        spellcheck="false"
                    >
                        <button type="submit" class="lp-search-btn" aria-label="Search">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                        </button>
                    </form>
                    <div class="lp-search-suggestions">
                        <span onclick="quickSearch('minimum slope 8 inch sewer')">min slope 8" sewer</span>
                        <span onclick="quickSearch('OSHA Type B soil trench')">OSHA Type B slope</span>
                        <span onclick="quickSearch('what is an ESOP')">what is an ESOP?</span>
                        <span onclick="quickSearch('thrust block 45 degree bend')">thrust block 45° bend</span>
                        <span onclick="quickSearch('811 blue stakes Utah')">811 blue stakes</span>
                        <span onclick="quickSearch('Manning n value PVC pipe')">Manning's n PVC</span>
                    </div>
                </div>

            </div>

            <div class="lp-hero-actions" id="hero-actions">
                <a href="/chat.html" class="lp-btn-primary">Try the AI free →</a>
                <a href="/calculators.html" class="lp-btn-secondary">Calculators</a>
                <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener" class="lp-btn-secondary">GitHub</a>
            </div>
            <p class="lp-hero-meta">
                No account. No paywall. Bring your own <a href="/documentation.html">API key</a> or use <a href="https://mudrag.com">mudrag.com</a> directly.
            </p>
            <p class="lp-hero-meta" style="margin-top:10px">
                New to AI in construction? Start with the <a href="/resources.html#ai-guide">AI guide</a>, then use the <a href="/resources.html#ai-workflows">prompt workflow templates</a> and <a href="/resources.html#ai-autonomy">autonomy + drone examples</a>.
            </p>
        </div>
    </section>

    <!-- Search results overlay — outside hero so overflow:hidden doesn't clip it -->
    <div class="lp-search-results" id="search-results">
        <div class="lp-sr-header">
            <div class="lp-sr-query-bar">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lp-sr-icon"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                <span class="lp-sr-query-text" id="sr-query-text"></span>
            </div>
            <button class="lp-sr-esc" onclick="closeSearch()">esc</button>
        </div>
        <div class="lp-search-results-inner">
            <div class="lp-search-answer" id="search-answer"></div>
            <div class="lp-search-sources" id="search-sources"></div>
        </div>
    </div>
    <div class="lp-search-backdrop" id="search-backdrop" onclick="closeSearch()"></div>

    <hr class="lp-divider">

    <!-- Stats -->
    <div class="lp-section-sm">
        <div class="lp-stats">
            <div class="lp-stat">
                <div class="lp-stat-num">24</div>
                <div class="lp-stat-label">Free construction calculators — trench volume, pipe flow, OSHA safety, markup, thrust blocks, and more</div>
            </div>
            <div class="lp-stat">
                <div class="lp-stat-num">$1.2T</div>
                <div class="lp-stat-label">IIJA infrastructure spend driving demand for smarter tools, faster bids, and better field data</div>
            </div>
            <div class="lp-stat">
                <div class="lp-stat-num">100+</div>
                <div class="lp-stat-label">Construction terms, OSHA standards, pipe specs, and field references — searchable and free</div>
            </div>
            <div class="lp-stat">
                <div class="lp-stat-num">6</div>
                <div class="lp-stat-label">Regional estimating rate tables: national, Utah, Mountain West, Texas, California, and Northeast</div>
            </div>
        </div>
    </div>

    <hr class="lp-divider">

    <!-- Features -->
    <section class="lp-section">
        <p class="lp-section-label">What's in openmud</p>
        <h2 class="lp-section-title">Everything in one place.</h2>
        <p class="lp-section-sub">AI that knows heavy civil, calculators that work without an account, and a reference library built from public domain standards.</p>

        <div class="lp-features">
            <a href="/chat.html" class="lp-feature">
                
                <div class="lp-feature-title">AI Chat</div>
                <div class="lp-feature-desc">Multi-model AI (GPT-4o, Claude, mud1) tuned for underground utility and heavy civil. Ask about costs, pipe sizing, scheduling, trench specs, or anything construction — and get answers that make sense in the field.</div>
                <div class="lp-feature-link">Chat → openmud.ai/chat</div>
            </a>
            <a href="/calculators.html" class="lp-feature">
                
                <div class="lp-feature-title">Calculators</div>
                <div class="lp-feature-desc">18 construction calculators: trench volume, pipe flow (Manning's), OSHA trench safety, thrust blocks, markup and bid price, unit price builder, change orders, production rates, crew day cost, unit converter, and more. All client-side — works offline.</div>
                <div class="lp-feature-link">Calculators → openmud.ai/calculators</div>
            </a>
            <a href="/resources.html" class="lp-feature">
                
                <div class="lp-feature-title">Resources</div>
                <div class="lp-feature-desc">Structured reference for the field: OSHA 29 CFR 1926 Subpart P, 811 Blue Stakes guide, confined space standards, utility color codes, pipe specs, soil classification, Manning's n values, YouTube channels, construction news, and a 60-term glossary. Includes a full <strong style="color:var(--text)">AI in Construction guide</strong> — history, prompt templates, autonomous equipment, and drone workflows.</div>
                <div class="lp-feature-link">Resources → openmud.ai/resources</div>
            </a>
            <a href="/companies.html" class="lp-feature">
                
                <div class="lp-feature-title">Companies</div>
                <div class="lp-feature-desc">Directory of 50+ construction companies: Utah contractors, ENR Top 25 national, ESOP employee-owned firms, publicly traded contractors with tickers. Revenue data, ownership type, what ESOP means, and where the industry market is heading.</div>
                <div class="lp-feature-link">Companies → openmud.ai/companies</div>
            </a>
            <a href="/chat.html?tool=estimate" class="lp-feature">
                
                <div class="lp-feature-title">Project Tools</div>
                <div class="lp-feature-desc">Full project estimator with 6 regional rate tables, schedule builder, and proposal generator — all powered by the openmud Python engine. Use them directly in your browser or call the REST API at /api/python/estimate.</div>
                <div class="lp-feature-link">Open tools in chat → openmud.ai/chat?tool=estimate</div>
            </a>
            <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener" class="lp-feature">
                
                <div class="lp-feature-title">Open Source</div>
                <div class="lp-feature-desc">The whole thing is open source. Fork it, deploy your own instance, contribute better pricing data, build new tools, improve the AI prompts. 75 automated tests, GitHub Actions CI, issue templates, and a full contributor guide.</div>
                <div class="lp-feature-link">GitHub → github.com/masonearl/openmud</div>
            </a>
        </div>
    </section>

    <hr class="lp-divider">

    <!-- Calc showcase -->
    <section class="lp-section">
        <p class="lp-section-label">Calculators</p>
        <h2 class="lp-section-title">The math, done right.</h2>
        <p class="lp-section-sub">Every calculator runs client-side — no account, no server, no API key required. Works on your phone on the job site.</p>

        <div class="lp-calc-grid">
            <a href="/calculators.html#trench-volume" class="lp-calc-card">
                <div class="lp-calc-card-name">Trench Volume</div>
                <div class="lp-calc-card-desc">LF × width × depth → excavation CY, backfill, bedding, spoil with swell factor</div>
            </a>
            <a href="/calculators.html#pipe-flow" class="lp-calc-card">
                <div class="lp-calc-card-name">Pipe Flow (Manning's)</div>
                <div class="lp-calc-card-desc">Diameter + slope + n → GPM, CFS, velocity. Full and partial flow. Min velocity check.</div>
            </a>
            <a href="/calculators.html#trench-safety" class="lp-calc-card">
                <div class="lp-calc-card-name">Trench Safety (OSHA)</div>
                <div class="lp-calc-card-desc">Type A/B/C soil × depth × method → slope setback, bench dims, shield requirements</div>
            </a>
            <a href="/calculators.html#thrust-block" class="lp-calc-card">
                <div class="lp-calc-card-name">Thrust Block Sizing</div>
                <div class="lp-calc-card-desc">Pipe size + pressure + fitting type → thrust force and concrete bearing area</div>
            </a>
            <a href="/calculators.html#markup" class="lp-calc-card">
                <div class="lp-calc-card-name">Markup & Bid Price</div>
                <div class="lp-calc-card-desc">Direct cost + overhead + profit → bid price. Or reverse: bid → implied cost.</div>
            </a>
            <a href="/calculators.html#change-order" class="lp-calc-card">
                <div class="lp-calc-card-name">Change Order</div>
                <div class="lp-calc-card-desc">T&M or unit price basis → CO total with O&P and bond. Print-ready breakdown.</div>
            </a>
            <a href="/calculators.html#production-rate" class="lp-calc-card">
                <div class="lp-calc-card-name">Production Rate</div>
                <div class="lp-calc-card-desc">Rate/day × crew cost × equip → duration, cost/LF, total project direct cost</div>
            </a>
            <a href="/calculators.html#unit-converter" class="lp-calc-card">
                <div class="lp-calc-card-name">Unit Converter</div>
                <div class="lp-calc-card-desc">CY ↔ CF ↔ tons · PSI ↔ ft water · BCY ↔ LCY ↔ CCY and more</div>
            </a>
            <a href="/calculators.html" class="lp-calc-card" style="border-style: dashed; justify-content: center; align-items: center; text-align: center; min-height: 80px;">
                <div class="lp-calc-card-name" style="color: var(--text-tertiary)">+ 10 more calculators →</div>
            </a>
        </div>
    </section>

    <hr class="lp-divider">

    <!-- Highlight cards -->
    <section class="lp-section">
        <p class="lp-section-label">Industry intelligence</p>
        <h2 class="lp-section-title">Built for the whole industry.</h2>
        <p class="lp-section-sub">Not just tools — a resource for understanding who the major players are and where the market is going.</p>

        <div class="lp-highlight">
            <a href="/companies.html#esop" class="lp-highlight-card">
                <div class="lp-highlight-card-label">Companies · ESOP</div>
                <div class="lp-highlight-card-title">What is an employee-owned construction company?</div>
                <div class="lp-highlight-card-desc">ESOPs are reshaping heavy civil. Emery Sapp & Sons, Achen-Gardner, ESCO, Rummel, Sundt — why employee ownership matters for culture, retention, and bid competitiveness. Plain-language explanation of how it works and why contractors do it.</div>
                <div class="lp-highlight-card-arrow">Read more →</div>
            </a>
            <a href="/companies.html#market-data" class="lp-highlight-card">
                <div class="lp-highlight-card-label">Market Data · IIJA</div>
                <div class="lp-highlight-card-title">$55 billion for water. Where is all this infrastructure money going?</div>
                <div class="lp-highlight-card-desc">The Infrastructure Investment and Jobs Act is the largest infrastructure bill in U.S. history. Sewer/water grew 23.7% in 2024. Power +18.9%. Telecom +59.7%. See the full breakdown of where the money is flowing and which markets are growing fastest.</div>
                <div class="lp-highlight-card-arrow">Read more →</div>
            </a>
            <a href="/resources.html#osha-excavation" class="lp-highlight-card">
                <div class="lp-highlight-card-label">Safety · OSHA Subpart P</div>
                <div class="lp-highlight-card-title">The complete OSHA trenching and excavation reference.</div>
                <div class="lp-highlight-card-desc">29 CFR 1926 Subpart P in plain language — soil classification table, required slope angles by type, competent person checklist, trench shield rules, and links to the full text. Public domain. Everything a super needs to know before anyone goes in a trench.</div>
                <div class="lp-highlight-card-arrow">Read more →</div>
            </a>
            <a href="/resources.html#bluestakes" class="lp-highlight-card">
                <div class="lp-highlight-card-label">Safety · 811 / Blue Stakes</div>
                <div class="lp-highlight-card-title">Call before you dig. Utah law, color codes, and the 5 steps.</div>
                <div class="lp-highlight-card-desc">811 is not optional. Utah Code 54-8a requires notification at least 3 business days before any excavation. Full guide: the 5 steps, utility color codes (all 9), what Blue Stakes doesn't cover, and how EPR works. Every excavator should know this cold.</div>
                <div class="lp-highlight-card-arrow">Read more →</div>
            </a>
        </div>
    </section>

    <hr class="lp-divider">

    <!-- Who it's for -->
    <section class="lp-section">
        <p class="lp-section-label">Who it's for</p>
        <h2 class="lp-section-title">Built for people who work in and on the dirt.</h2>
        <p class="lp-section-sub">openmud is for the people who actually do the work — not generic AI with a hard hat sticker on it.</p>

        <div class="lp-audience">
            <div class="lp-audience-card">
                <div class="lp-audience-role">Estimators</div>
                <div class="lp-audience-desc">Quick bid on 1,500 LF of 8" sewer in clay. Material, labor, equipment breakdown in seconds. Unit price builder with overhead and profit. Change order calculator. Production rate cost analysis. All without a subscription.</div>
            </div>
            <div class="lp-audience-card">
                <div class="lp-audience-role">Project Managers & Supers</div>
                <div class="lp-audience-desc">Phased construction schedule from scope. Proposal generator for clients. Trench safety reference when you need to remember the Type C slope angle at 2am before a morning pour. Crew day cost calculator for T&M work.</div>
            </div>
            <div class="lp-audience-card">
                <div class="lp-audience-role">Field Engineers</div>
                <div class="lp-audience-desc">Pipe flow calculations for storm drain sizing. Minimum slope for 6" PVC sewer. Thrust block bearing area for a 45° bend at 150 PSI. Grade and slope from two elevations. All of it on your phone, no account required.</div>
            </div>
            <div class="lp-audience-card">
                <div class="lp-audience-role">Developers & Contech Builders</div>
                <div class="lp-audience-desc">Fork the repo. Import the Python tools. Build on the API. The estimating, hydraulics, safety, and bid math functions are standalone and MIT licensed — use them in your own apps, scripts, and workflows. No vendor lock-in.</div>
            </div>
        </div>
    </section>

    <hr class="lp-divider">

    <!-- Open source -->
    <section class="lp-section-sm">
        <div class="lp-oss">
            <div>
                <p class="lp-section-label">Open source</p>
                <h2 class="lp-oss-title">The construction industry deserves open tools.</h2>
                <p class="lp-oss-desc">Most construction software is expensive, locked down, and built by people who've never been on a job site. openmud is the opposite — free, open source, built in the field and for the field. Your experience is worth more than our code. Submit a PR with better pricing data. Open an issue with a field problem that needs a tool. Fork it and build what your company actually needs.</p>
            </div>
            <div class="lp-oss-actions">
                <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener" class="lp-btn-primary">Star on GitHub →</a>
                <a href="https://github.com/masonearl/openmud/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener" class="lp-btn-secondary">How to contribute</a>
                <a href="https://github.com/masonearl/openmud/discussions" target="_blank" rel="noopener" class="lp-btn-secondary">Join the discussion</a>
                <a href="https://discord.gg/qszzMjxD3" target="_blank" rel="noopener" class="lp-btn-secondary">Join Discord</a>
            </div>
        </div>
    </section>

    <hr class="lp-divider">

    <!-- Mission -->
    <div class="lp-mission">
        <p class="lp-section-label" style="text-align:center">Mission</p>
        <h2 class="lp-mission-title">Make AI a practical tool<br><em>for every phase of the job.</em></h2>
        <p class="lp-mission-body">From bid to closeout. The pricing data, the field math, the safety standards, the company intel — all of it open, free, and getting better because people who actually know construction are contributing to it. That's what openmud is building toward.</p>
    </div>

    <!-- Footer -->
    <footer>
        <div class="lp-footer">
            <div>
                <a href="/" class="lp-footer-logo">openmud</a>
                <p class="lp-footer-tagline">Open-source AI for heavy civil construction.<br>MIT license. Free forever.</p>
            </div>
            <div class="lp-footer-links">
                <div class="lp-footer-col">
                    <div class="lp-footer-col-title">Tools</div>
                    <a href="/chat.html">AI Chat</a>
                    <a href="/calculators.html">Calculators</a>
                    <a href="/calculators.html#trench-volume">Trench Volume</a>
                    <a href="/calculators.html#pipe-flow">Pipe Flow</a>
                    <a href="/calculators.html#markup">Markup Calculator</a>
                </div>
                <div class="lp-footer-col">
                    <div class="lp-footer-col-title">Resources</div>
                    <a href="/resources.html#osha-excavation">OSHA Subpart P</a>
                    <a href="/resources.html#bluestakes">811 / Blue Stakes</a>
                    <a href="/resources.html#youtube">YouTube Channels</a>
                    <a href="/resources.html#glossary">Field Glossary</a>
                    <a href="/companies.html">Companies</a>
                </div>
                <div class="lp-footer-col">
                    <div class="lp-footer-col-title">Project</div>
                    <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener">GitHub</a>
                    <a href="https://discord.gg/qszzMjxD3" target="_blank" rel="noopener">Discord</a>
                    <a href="https://github.com/masonearl/openmud/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener">Contributing</a>
                    <a href="https://github.com/masonearl/openmud/discussions" target="_blank" rel="noopener">Discussions</a>
                    <a href="https://github.com/masonearl/openmud/releases" target="_blank" rel="noopener">Releases</a>
                    <a href="/documentation.html">Documentation</a>
                </div>
            </div>
        </div>
        <div class="lp-footer-bottom">
            <span>© <span id="year"></span> openmud · MIT License</span>
            <span>
                <a href="https://github.com/masonearl/openmud" target="_blank" rel="noopener">GitHub</a> ·
                <a href="https://discord.gg/qszzMjxD3" target="_blank" rel="noopener">Discord</a> ·
                <a href="/about.html">About</a> ·
                <a href="mailto:hi@masonearl.com">Contact</a>
            </span>
        </div>
    </footer>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();
        const SEARCH_LOADING_MESSAGES = [
            'Searching…',
            'Cooking…',
            'Generating…',
            'Pulling sources…',
            'Checking references…',
        ];
        let activeSearchController = null;
        let activeSearchRequestId = 0;
        let searchLoadingTimer = null;
        let searchLoadingIndex = 0;

        function startSearchLoading(answerEl) {
            stopSearchLoading();
            searchLoadingIndex = 0;
            answerEl.innerHTML = '<div class="lp-search-loading">' +
                '<div class="lp-search-loading-dots"><span></span><span></span><span></span></div>' +
                '<p class="lp-search-loading-label" id="search-loading-label">' + SEARCH_LOADING_MESSAGES[0] + '</p>' +
                '</div>';
            searchLoadingTimer = setInterval(() => {
                searchLoadingIndex = (searchLoadingIndex + 1) % SEARCH_LOADING_MESSAGES.length;
                const loadingLabel = document.getElementById('search-loading-label');
                if (loadingLabel) loadingLabel.textContent = SEARCH_LOADING_MESSAGES[searchLoadingIndex];
            }, 950);
        }

        function stopSearchLoading() {
            if (searchLoadingTimer) {
                clearInterval(searchLoadingTimer);
                searchLoadingTimer = null;
            }
        }

        function quickSearch(q) {
            document.getElementById('site-search-input').value = q;
            runSearch(null);
        }

        async function runSearch(e) {
            if (e) e.preventDefault();
            const query = document.getElementById('site-search-input').value.trim();
            if (!query) return;

            const resultsEl = document.getElementById('search-results');
            const backdropEl = document.getElementById('search-backdrop');
            const answerEl = document.getElementById('search-answer');
            const sourcesEl = document.getElementById('search-sources');

            document.getElementById('sr-query-text').textContent = query;
            resultsEl.classList.add('visible');
            backdropEl.classList.add('visible');
            document.body.style.overflow = 'hidden';
            sourcesEl.innerHTML = '';
            startSearchLoading(answerEl);

            if (activeSearchController) {
                activeSearchController.abort();
            }
            const requestId = ++activeSearchRequestId;
            activeSearchController = new AbortController();
            const signal = activeSearchController.signal;

            try {
                const res = await fetch('/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query }),
                    signal,
                });
                if (!res.ok) throw new Error('Search request failed');
                const data = await res.json();
                if (requestId !== activeSearchRequestId) return;
                stopSearchLoading();
                activeSearchController = null;

                answerEl.innerHTML = '<p class="lp-search-answer-text">' + (data.answer || 'No answer found.') + '</p>';

                if (data.sources && data.sources.length) {
                    sourcesEl.innerHTML = '<p class="lp-search-sources-label">Sources</p>' +
                        data.sources.map(s =>
                            '<a href="' + s.url + '" class="lp-search-source-card">' +
                            '<span class="lp-src-category">' + s.category + '</span>' +
                            '<span class="lp-src-title">' + s.title + '</span>' +
                            '<span class="lp-src-excerpt">' + s.excerpt + '</span>' +
                            '</a>'
                        ).join('');
                }
            } catch (err) {
                if (requestId !== activeSearchRequestId) return;
                if (err && err.name === 'AbortError') return;
                stopSearchLoading();
                activeSearchController = null;
                answerEl.innerHTML = '<p class="lp-search-answer-text" style="color:var(--text-secondary)">Search unavailable. Try the <a href="/resources.html" style="color:inherit;text-decoration:underline">Resources</a> or <a href="/calculators.html" style="color:inherit;text-decoration:underline">Calculators</a> pages.</p>';
            }
        }

        function closeSearch() {
            if (activeSearchController) {
                activeSearchController.abort();
                activeSearchController = null;
            }
            activeSearchRequestId += 1;
            stopSearchLoading();
            document.getElementById('search-results').classList.remove('visible');
            document.getElementById('search-backdrop').classList.remove('visible');
            document.body.style.overflow = '';
            document.getElementById('site-search-input').value = '';
            startPlaceholderCycle();
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeSearch();
        });

        // Rolling placeholder animation
        const PLACEHOLDER_QUERIES = [
            'minimum slope for 8" sewer pipe',
            'OSHA Type B soil trench requirements',
            'Manning\'s n value for PVC pipe',
            'thrust block sizing for 45° bend',
            'what is an ESOP in construction?',
            '811 blue stakes — who do I call?',
            'bedding requirements for ductile iron pipe',
            'OSHA confined space entry checklist',
            'how to calculate trench volume',
            'water main pressure testing procedure',
            'shoring vs sloping — which do I use?',
            'pipe deflection limits for PVC',
            'how deep before shoring is required?',
            'union vs open shop in heavy civil',
            'OSHA 1926 Subpart P summary',
        ];

        let phIndex = 0;
        let phCharIndex = 0;
        let phDeleting = false;
        let phTimeout = null;
        let phPaused = false;

        function animatePlaceholder() {
            const input = document.getElementById('site-search-input');
            if (!input || document.activeElement === input || phPaused) return;

            const current = PLACEHOLDER_QUERIES[phIndex];

            if (!phDeleting) {
                phCharIndex++;
                input.placeholder = current.slice(0, phCharIndex);
                if (phCharIndex === current.length) {
                    phDeleting = true;
                    phTimeout = setTimeout(animatePlaceholder, 2200);
                } else {
                    phTimeout = setTimeout(animatePlaceholder, 38);
                }
            } else {
                phCharIndex--;
                input.placeholder = current.slice(0, phCharIndex);
                if (phCharIndex === 0) {
                    phDeleting = false;
                    phIndex = (phIndex + 1) % PLACEHOLDER_QUERIES.length;
                    phTimeout = setTimeout(animatePlaceholder, 400);
                } else {
                    phTimeout = setTimeout(animatePlaceholder, 18);
                }
            }
        }

        function startPlaceholderCycle() {
            phPaused = false;
            clearTimeout(phTimeout);
            phCharIndex = 0;
            phDeleting = false;
            phTimeout = setTimeout(animatePlaceholder, 800);
        }

        // Pause animation while user is typing
        document.getElementById('site-search-input').addEventListener('focus', () => {
            phPaused = true;
            clearTimeout(phTimeout);
            document.getElementById('site-search-input').placeholder = '';
        });
        document.getElementById('site-search-input').addEventListener('blur', () => {
            if (!document.getElementById('site-search-input').value) {
                startPlaceholderCycle();
            }
        });

        startPlaceholderCycle();

    </script>
</body>
</html>
